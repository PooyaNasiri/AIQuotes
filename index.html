<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AIQuotes</title>
    <link type="image/png" sizes="16x16" rel="icon" href="assets/icons8-robot-blue-16.png"> 
    <link type="image/png" sizes="32x32" rel="icon" href="assets/icons8-robot-blue-32.png"> 
    <link type="image/png" sizes="96x96" rel="icon" href="assets/icons8-robot-blue-96.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Indie+Flower&family=Caveat&display=swap" rel="stylesheet">
    <style>
      body{ font-family:  "Comic Sans MS";display:flex;min-height:100vh;align-items:center;justify-content:center;background:linear-gradient(135deg,#07132b 0%, #081426 40%, #10243a 100%);color:#e6eef8;margin:0}
      .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:28px;border-radius:14px;box-shadow:0 10px 40px rgba(2,6,23,.7);width:min(760px,94%);text-align:center;border:1px solid rgba(255,255,255,0.03)}
      h1{margin:0 0 12px 0;font-size:20px;letter-spacing:.6px}
      .controls{display:flex;flex-direction:column;gap:10px;align-items:center;margin-bottom:14px}
      .control-row{display:flex;gap:12px;align-items:center}
      .control-row.small{font-size:13px;color:#9fb0d3}
      .label{font-weight:600}
      .vertical-number{display:flex;flex-direction:column;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:6px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);width:88px;transition:transform .28s cubic-bezier(.2,.9,.2,1)}
      .vertical-number:hover{transform:translateY(-4px)}
      .vertical-number .arrow{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border:none;color:#cfe6ff;padding:6px 8px;font-size:12px;cursor:pointer;line-height:1;border-radius:8px;margin:6px;transition:transform .18s ease, box-shadow .18s ease}
      .vertical-number .arrow:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(124,58,237,.08)}
      /* general arrow style used in the inline header control */
      .arrow{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border:none;color:#cfe6ff;padding:4px 10px;font-size:12px;cursor:pointer;line-height:1;border-radius:8px;min-width:44px;height:30px;display:inline-flex;align-items:center;justify-content:center;transition:transform .18s ease, box-shadow .18s ease}
      .arrow:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(124,58,237,.08)}
      .vertical-number input[type=number]{width:64px;background:transparent;border:none;color:#e6eef8;text-align:center;font-size:20px;-moz-appearance:textfield;transition:transform .28s cubic-bezier(.2,.9,.2,1), color .18s}
      .vertical-number input[type=number].num-animate{animation:numPop .36s ease}
      @keyframes numPop{0%{transform:translateY(-6px) scale(.95);opacity:.6}50%{transform:translateY(3px) scale(1.06);opacity:1}100%{transform:translateY(0) scale(1)} }
      /* Counter styles (inspired by reactbits Counter) */
      .counter-container { position: relative; display: inline-block; text-align:center;}
      .counter-counter { display: flex; overflow: hidden; line-height: 1;  padding: 0px 10px 0px 10px;text-align:center; }
      .counter-digit { position: relative; width: auto; width: 1ch; font-variant-numeric: tabular-nums; }
      .counter-number { position: absolute; top: 0; right: 0; bottom: 0; left: 0; display:flex; align-items:center; justify-content:center; }
      /* .gradient-container { pointer-events: none; position: absolute; top: 0; bottom: 0; left: 0; right: 0; } */
      /* .bottom-gradient { position: absolute; bottom: 0; width: 100%; } */
      /* dot-grid background (subtle overlay like reactbits dot-grid) */
      body::before{content:'';position:fixed;inset:0;pointer-events:none;opacity:0.06;background-image:radial-gradient(rgba(255,255,255,0.12) 1px, rgba(255,255,255,0) 1px);background-size:18px 18px;mix-blend-mode:overlay}
      input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
      button#generate{position:relative;overflow:hidden;background:linear-gradient(90deg,#7c3aed,#2dd4bf);border:none;color:#041025;padding:12px 22px;border-radius:14px;font-weight:800;cursor:pointer;box-shadow:0 10px 30px rgba(124,58,237,.14);transition:transform .12s ease, box-shadow .12s ease;background-size:200% 200%}
      /* fancy hover and animated gradient */
      /* button#generate:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 18px 50px rgba(124,58,237,.25),0 6px 22px rgba(45,212,191,.12);filter:brightness(1.06)} */
      /* button#generate:before{content:'';position:absolute;inset:0;border-radius:14px;pointer-events:none;background:radial-gradient(120px 60px at 20% 10%, rgba(255,255,255,0.18), rgba(255,255,255,0) 30%);opacity:0;transition:opacity .25s} */
      /* button#generate:hover:before{opacity:1} */
      /* animated gradient movement */
      /* @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
      button#generate.animate-bg{animation:gradientMove 6s linear infinite} */
      /* sheen effect sliding across on click */
      button#generate:after{content:'';position:absolute;left:-60%;top:0;width:60%;height:100%;transform:skewX(-18deg);background:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,0.12),rgba(255,255,255,0));opacity:0;transition:opacity .12s, transform .42s}
      button#generate.sheen:after{opacity:1;transform:translateX(220%)}
      /* pop animation when clicked */
      @keyframes pop {0%{transform:scale(1)}40%{transform:scale(1.08)}100%{transform:scale(1)}}
      button#generate.pop{animation:pop .32s cubic-bezier(.2,.9,.2,1)}
      /* loading tweaks */
      button#generate.loading{box-shadow:0 14px 40px rgba(45,212,191,.08);transform:translateY(-2px)}
      button#generate.loading .btn-text{transform:translateX(-6px)}
      /* spinner already present */
      button#generate .btn-text{display:inline-block;transition:transform .18s cubic-bezier(.2,.9,.2,1); padding: 10px;}
      /* apply styles to both id and class-based quote elements */
      /* Large, well-spaced quote area */
      #quote, .quote{
        font-size:56px;
        margin:64px 0 72px;
        line-height:1.14;
        color:#e8f6ff;
        min-height:220px;
        transition:opacity .22s ease, transform .22s cubic-bezier(.2,.9,.2,1);
        z-index:2; /* ensure quote sits above decorative layers */
        position:relative;
        text-wrap:balance;
      }

      /* small decorative shimmer when generating */
      .shimmer{position:relative;overflow:hidden}
      .shimmer:after{content:'';position:absolute;left:-40%;top:0;width:40%;height:100%;transform:skewX(-18deg);background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.07), rgba(255,255,255,0));opacity:100;transition:opacity .12s}
      /* button#generate.loading ~ .quote.shimmer:after{opacity:1;animation:shimmer 900ms linear} */
      @keyframes shimmer{0%{left:-40%}100%{left:140%}}

      /* toast for copy-to-clipboard feedback */
      #copy-toast{position:fixed;left:50%;bottom:28px;transform:translateX(-50%) translateY(20px);background:rgba(6,10,20,0.92);color:#e6eef8;padding:10px 14px;border-radius:12px;font-size:14px;box-shadow:0 6px 22px rgba(3,8,25,0.6);opacity:0;pointer-events:none;transition:transform .22s cubic-bezier(.2,.9,.2,1),opacity .18s ease;z-index:9999}
      #copy-toast.visible{opacity:1;transform:translateX(-50%) translateY(0)}

      footer{font-size:12px;color:#9fb0d3;margin-top:14px}
      @media (max-width:520px){
        .control-row{flex-direction:column}
        #quote, .quote{font-size:22px;margin:18px 0 20px;min-height:72px}
        .arrow{min-width:36px;font-size:11px;height:28px;padding:4px 8px}
      }
      /* ---------- Gooey single-element button styles (adapted) ---------- */
      @property --a { syntax: "<percentage>"; initial-value: 0%; inherits: true; }
      @property --hue { syntax: "<angle>"; initial-value: 170deg; inherits: false; }

      :root{ --spring-easing: linear(0,0.002,0.01 0.9%,0.038 1.8%,0.156,0.312 5.8%,0.789 11.1%,1.015 14.2%,1.096,1.157,1.199,1.224 20.3%,1.231,1.231,1.226,1.214 24.6%,1.176 26.9%,1.057 32.6%,1.007 35.5%,0.984,0.968,0.956,0.949 42%,0.946 44.1%,0.95 46.5%,0.998 57.2%,1.007,1.011 63.3%,1.012 68.3%,0.998 84%,1); --spring-duration:1.66s }

      /* hue animation used by the gooey button */
      @keyframes color {
        from { --hue: 0deg; }
        to   { --hue: 600deg; }
      }

      /* Make the generate button purely gooey (single visible blurred layer) */
      #generate.gooey{
        --a: 0%; --hue: 170deg; --x:50; --y:50; --button: hsl(var(--hue),100%,100%); --size:2em;
        background: transparent; /* no solid base — visual comes from :before */
        color: #041025; /* text color placed above the goo layer */
        font-size:1.05rem; position:relative; padding:calc(var(--size)*0.6) calc(var(--size)*1.2);
        transition: --a .45s ease-in-out, scale var(--spring-duration) var(--spring-easing); scale:0.98;
        isolation:isolate; border-radius:94px; cursor:pointer; border:none; box-shadow:none;
      }
      #generate.gooey:hover{ --a:100%; transition-duration:.45s,1s; scale:1 }

      /* The blurred gooey blob behind the button provides the visible shape */
      #generate.gooey:before{ content:""; position:absolute; inset:0; filter: blur(12px) url(#goo) drop-shadow(0 .25em .5em rgba(0,0,0,0.6));
        /* base color is a subtle linear, plus a radial color that follows pointer via --x/--y */
        background-image:
          linear-gradient(0deg, var(--button), var(--button)),
          radial-gradient(40% 70% at calc(var(--x) * 1%) calc(var(--y) * 1%), hsla(var(--hue),77%,77%,var(--a)) 0%, transparent 90%);
        background-clip: content-box, border-box; padding: 14px; z-index:-1; border-radius:94px; animation:color 20s linear infinite both;
      }

      @media (max-width:420px){
        /* Make the card nearly full-bleed on small phones and reduce padding for readable content */
        .card{width:calc(100% - 18px);padding:14px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,.6)}
        body{padding:6px}

        /* Quote: reduce size and margins so it fits without excessive scrolling */
        #quote, .quote{font-size:20px;margin:14px 0 18px;line-height:1.18;min-height:92px}

        /* Stack controls and tighten spacing */
        .control-row{flex-direction:row;gap:8px;align-items:center;justify-content:center}
        .control-row.small{font-size:12px}

        /* Counter and word scroller: scale down to fit the header area */
        .counter-container{transform:scale(0.78);transform-origin:center;display:inline-block}
        .counter-counter{gap:6px}
        .counter-digit{width:auto}

        /* Word scroller min width handled inline; reduce by a bit when available */
        .word-scroller, .word-scroller > div{min-width:140px}

        /* Arrows: smaller hit targets but still tappable */
        .arrow{min-width:34px;height:30px;font-size:12px;padding:6px 8px}

        /* Gooey button: reduce blur and padding to save space and improve performance on phones */
        #generate.gooey{--size:1.4em;font-size:0.95rem;padding:calc(var(--size)*0.5) calc(var(--size)*0.9);border-radius:12px}
        #generate.gooey:before{filter: blur(8px) url(#goo) drop-shadow(0 .18em .36em rgba(0,0,0,0.55));padding:10px}

        /* Tone the animated background and heavy motion on small devices */
        #generate.gooey{transition: --a .3s ease-in-out, scale calc(var(--spring-duration)*0.6) var(--spring-easing)}

        /* Reduce dot-grid visual intensity on phones to save GPU work */
        body::before{opacity:0.04;background-size:22px 22px}

        /* Slightly reduce canvas dot size if present */
        canvas{max-height:420px}
      }

      /* Responsive sizing helpers (fluid typography and component scaling) */
      :root{
        --card-max-width:920px;
        --quote-min:20px; --quote-pref:5vw; --quote-max:72px;
        --control-min:12px; --control-pref:2.2vw; --control-max:20px;
      }

      /* Make card, title and quote scale fluidly between small and large screens */
      .card{ width: clamp(320px, min(94%, var(--card-max-width)), 1100px); }
      h1{ font-size: clamp(16px, 1.6vw + 6px, 22px); }
      #quote, .quote{ font-size: clamp(var(--quote-min), var(--quote-pref), var(--quote-max)); margin: clamp(16px, 3.2vw, 64px) 0 clamp(18px, 3.8vw, 72px); min-height: clamp(88px, 18vh, 220px); }

      /* Tighter spacing for control rows on narrow viewports while remaining roomy on desktop */
      .control-row{ gap: clamp(8px, 1.6vw, 18px); }
      .control-row.small{ font-size: clamp(12px, var(--control-pref), var(--control-max)); }

      /* Counter container scales instead of fixed pixel transforms — avoids very large digits on small screens */
      .counter-container{ transform: none; }
      .counter-counter{ gap: clamp(6px, 1.2vw, 18px); }
      .counter-digit{ width: auto; }

      /* Word scroller: scale the words fluidly and reduce min width on small screens */
      /* .word-scroller{ min-width: clamp(120px, 22vw, 260px); } */
      /* .word-scroller > div > div{ font-size: clamp(18px, 3.6vw, 36px) !important; line-height: clamp(28px, 4.6vw, 40px) !important; } */

      /* Gooey button: fluid size & padding so it reads well on phones and large displays */
      #generate.gooey{ font-size: clamp(0.9rem, 2.2vw, 1.15rem); padding: clamp(8px, 1.6vw, 16px) clamp(12px, 2.8vw, 26px); --size: clamp(1.2em, 2.6vw, 2em); border-radius: clamp(10px, 2.2vw, 20px); }
      #generate.gooey:before{ padding: clamp(8px, 1.7vw, 14px); filter: blur(clamp(6px, 1.8vw, 12px)) url(#goo) drop-shadow(0 .22em .44em rgba(0,0,0,0.56)); }

      /* Reduce decorative intensity on small devices for performance and clarity */
      @media (max-width:520px){
        body::before{ opacity:0.035; background-size:22px 22px; }
        .card{ padding: clamp(10px, 2.2vw, 28px); border-radius:12px; }
        #generate.gooey{ --size: clamp(1em, 3.4vw, 1.4em); }
      }

      /* Give larger screens a bit more breathing room */
      @media (min-width:1200px){
        .card{ padding:36px; border-radius:18px; }
        #quote, .quote{ font-size: clamp(32px, 3.8vw, 72px); }
        .control-row{ gap:20px; }
      }
    </style>
  </head>
  <body>
    <main class="card">
      <div id="root"></div>
    </main>

    <!-- React + Babel (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Small React app implementing a fancy Counter and DecryptedText reveal -->
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // Simple DecryptedText: reveals text character-by-character with 'decrypt' effect
      function DecryptedText({ text, reveal }){
        const [out, setOut] = useState('');
        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        useEffect(()=>{
          if(!reveal){ setOut(text); return; }
          let cancelled = false;
          const target = text || '';
          const len = target.length;
          let frame = 0;
          const steps = 18 + Math.floor(len/2);
          const interval = 28;
          const tm = setInterval(()=>{
            frame++;
            let s = '';
            for(let i=0;i<len;i++){
              if(i < Math.floor((frame/steps)*len)) s += target[i];
              else s += alphabet[Math.floor(Math.random()*alphabet.length)];
            }
            if(!cancelled) setOut(s);
            if(frame >= steps){
              if(!cancelled) setOut(target);
              clearInterval(tm);
            }
          }, interval);
          return ()=>{ cancelled = true; clearInterval(tm); };
        }, [text, reveal]);

        const handleCopy = () => {
          navigator.clipboard.writeText(text).then(() => {
            const toast = document.getElementById('copy-toast');
            if (toast) {
              toast.classList.add('visible');
              setTimeout(() => toast.classList.remove('visible'), 2000);
            }
          });
        };

        return (
          <div
            className="quote shimmer in"
            aria-live="polite"
            onClick={handleCopy}
            onKeyDown={(e) => e.key === 'Enter' && handleCopy()}
            role="button"
            tabIndex={0}
            title="Click to copy"
          >
            {out}
          </div>
        );
      }

      // Small helper to show the copy toast
      function showCopyToast(){
        const t = document.getElementById('copy-toast');
        if(!t) return;
        t.classList.add('visible');
        clearTimeout(t._hideTimer);
        t._hideTimer = setTimeout(()=>{ t.classList.remove('visible'); }, 1500);
      }

      // helper to copy text with fallback
      async function copyToClipboard(text){
        if(!text) return false;
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
            return true;
          }
        }catch(e){ /* fallthrough to fallback */ }
        // fallback
        try{
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly','');
          ta.style.position = 'absolute'; ta.style.left = '-9999px';
          document.body.appendChild(ta);
          const sel = document.getSelection();
          const range = document.createRange();
          range.selectNodeContents(ta);
          sel.removeAllRanges(); sel.addRange(range);
          const ok = document.execCommand('copy');
          sel.removeAllRanges(); document.body.removeChild(ta);
          return ok;
        }catch(e){ return false; }
      }

      // Rich animated Counter (single-file, no external motion lib)
      function Digit({ place, value, height, digitStyle }){
        const valueRoundedToPlace = Math.floor(value / place);
        const animatedRef = useRef(valueRoundedToPlace);
        const [, setTick] = useState(0);
        const targetRef = useRef(valueRoundedToPlace);

        useEffect(()=>{ targetRef.current = valueRoundedToPlace; }, [valueRoundedToPlace]);

        useEffect(()=>{
          let raf;
          let mounted = true;
          function step(){
            if(!mounted) return;
            const cur = animatedRef.current;
            const target = targetRef.current;
            const diff = target - cur;
            const next = Math.abs(diff) < 0.0001 ? target : cur + diff * 0.22;
            animatedRef.current = next;
            // trigger render
            setTick(t => t + 1);
            raf = requestAnimationFrame(step);
          }
          raf = requestAnimationFrame(step);
          return ()=>{ mounted = false; cancelAnimationFrame(raf); };
        }, []);

        return (
          <div className="counter-digit" style={{ height: height + 'px', ...digitStyle }}>
            {Array.from({length:10}, (_, i)=>{
              const animated = animatedRef.current;
              // compute continuous offset and wrap to nearest -5..4
              let pos = (i - animated) % 10;
              if(pos < -5) pos += 10;
              if(pos > 4) pos -= 10;
              const memo = pos * height;
              // NEGATE memo to invert the animation direction so "up" increments move digits downward
              const style = { transform: `translateY(${-memo}px)` };
              return (<div key={i} className="counter-number" style={style}>{i}</div>);
            })}
          </div>
        );
      }

      function Counter({ value, fontSize = 80, padding = 5, places = [100,10,1], gap = 10, textColor='white', fontWeight=900 }){
        const height = fontSize + padding;
        const counterStyle = { fontSize: fontSize + 'px', gap: gap + 'px', color: textColor, fontWeight };
        return (
          <div className="control-row" style={{alignItems:'center', justifyContent:'center'}}>
            <div className="counter-container">
              <div className="counter-counter" style={{ ...counterStyle }}>
                {places.map(p => (<Digit key={p} place={p} value={value} height={height} digitStyle={{}} />))}
              </div>
            </div>
          </div>
        );
      }

      // WordScroller: animates a vertical list of words similar to the Digit scroller
      function WordScroller({ items, index, fontSize = 30, lineHeight = 40, minWidth = 180 }){
        const height = lineHeight;
        const animatedRef = useRef(index);
        const [, setTick] = useState(0);
        const targetRef = useRef(index);

        useEffect(()=>{ targetRef.current = index; }, [index]);

        useEffect(()=>{
          let raf;
          let mounted = true;
          function step(){
            if(!mounted) return;
            const cur = animatedRef.current;
            const target = targetRef.current;
            const diff = target - cur;
            const next = Math.abs(diff) < 0.0001 ? target : cur + diff * 0.22;
            animatedRef.current = next;
            setTick(t => t + 1);
            raf = requestAnimationFrame(step);
          }
          raf = requestAnimationFrame(step);
          return ()=>{ mounted = false; cancelAnimationFrame(raf); };
        }, []);

        const len = items.length;
        return (
          <div className="word-scroller" style={{height:height + 'px', overflow:'hidden', display:'flex', alignItems:'center', justifyContent:'center', minWidth: minWidth + 'px'}}>
            <div style={{position:'relative', height: height + 'px'}}>
              {items.map((it, i) => {
                // position each word relative to the animated fractional index, wrap circularly
                const animated = animatedRef.current;
                let pos = (i - animated) % len;
                if(pos < -len/2) pos += len;
                if(pos > len/2) pos -= len;
                const y = pos * height;
                const style = { position: 'absolute', left:0, right:0, top:0, height: height + 'px', display:'flex', alignItems:'center', justifyContent:'center', transform: `translateY(${y}px)`, color:'#e8f6ff', fontWeight:900, fontSize: fontSize + 'px', lineHeight: height + 'px' };
                return (<div key={i} style={style} aria-hidden={i !== index}>{it}</div>);
              })}
            </div>
          </div>
        );
      }

      function App(){
          const [n, setN] = useState(5);
            const [quote, setQuote] = useState('');
            const [loading, setLoading] = useState(false);
            const [reveal, setReveal] = useState(false);
          // hook to wire gooey button interactions (pointer tracking + intro)
          useEffect(()=>{
            const btn = document.getElementById('generate');
            if(!btn) return;
            let introInterval;
            function moveBg(e){ const rect = btn.getBoundingClientRect(); btn.style.setProperty('--x', ((e.clientX - rect.x)/rect.width)*100); btn.style.setProperty('--y', ((e.clientY - rect.y)/rect.height)*100); }
            function onOver(e){ clearInterval(introInterval); e.target.style.setProperty('--a',''); }
            function intro(){ let i = 4; btn.style.setProperty('--a','100%'); introInterval = setInterval(()=>{ btn.style.setProperty('--x', ((Math.cos(i)+2)/3.6)*100); btn.style.setProperty('--y', ((Math.sin(i)+2)/3.6)*100); i+=0.03; if(i>11.5){ clearInterval(introInterval); btn.style.setProperty('--a',''); } },16); }
            btn.addEventListener('pointermove', moveBg);
            btn.addEventListener('pointerover', onOver);
            intro();
            return ()=>{ btn.removeEventListener('pointermove', moveBg); btn.removeEventListener('pointerover', onOver); clearInterval(introInterval); };
          }, []);

        const GAS_URL = 'https://script.google.com/macros/s/AKfycby9UbqEoL7JDLnv9xbHlsOwIJv6jIlSHOE2m_gL2_yiA6OV8H51ruarg6kmgzix1ruuFQ/exec';
        // styles list for the selectable word control (diverse tones)
        const styles = [
          'Cynical', 'Melancholic', 'Funny', 'Motivational', 'Playful',
          'Dark', 'Bad', 'Brave', 'Uplifting', 'Silly',
          'Bold', 'Neutral', 'Angry', 'Confident', 'Inspirational',
          'Encouraging', 'Positive', 'Sarcastic', 'Weird', 'Calm',
          'Quirky', 'Philosophical', 'Dramatic', 'Nostalgic', 'Hopeful'
        ];

        const [styleIndex, setStyleIndex] = useState(0);

        // Simple DotGrid background component (lightweight, no GSAP)
        function DotGridOverlay(){
          const canvasRef = useRef(null);
          const wrapperRef = useRef(null);
          const dotsRef = useRef([]);
          useEffect(()=>{
            const canvas = canvasRef.current;
            const wrap = wrapperRef.current;
            if(!canvas || !wrap) return;
            const resize = ()=>{
              const rect = wrap.getBoundingClientRect();
              const dpr = window.devicePixelRatio || 1;
              canvas.width = rect.width * dpr;
              canvas.height = rect.height * dpr;
              canvas.style.width = rect.width + 'px';
              canvas.style.height = rect.height + 'px';
              const gap = 18;
              const dotSize = 6;
              const cols = Math.floor((rect.width + gap)/(dotSize+gap));
              const rows = Math.floor((rect.height + gap)/(dotSize+gap));
              const cell = dotSize + gap;
              const gridW = cell * cols - gap;
              const gridH = cell * rows - gap;
              const extraX = rect.width - gridW;
              const extraY = rect.height - gridH;
              const startX = extraX/2 + dotSize/2;
              const startY = extraY/2 + dotSize/2;
              const dots = [];
              for(let y=0;y<rows;y++){
                for(let x=0;x<cols;x++){
                  dots.push({cx: startX + x*cell, cy: startY + y*cell, ox:0, oy:0});
                }
              }
              dotsRef.current = dots;
            };
            resize();
            window.addEventListener('resize', resize);
            let raf;
            const pointer = {x:-9999,y:-9999};
            window.addEventListener('mousemove', (e)=>{ const r = canvas.getBoundingClientRect(); pointer.x = e.clientX - r.left; pointer.y = e.clientY - r.top; });
            window.addEventListener('click', (e)=>{ const r = canvas.getBoundingClientRect(); const cx = e.clientX - r.left; const cy = e.clientY - r.top; for(const d of dotsRef.current){ const dist = Math.hypot(d.cx-cx,d.cy-cy); if(dist<120){ const f = 1 - dist/120; d.ox += (d.cx-cx)*0.04*f; d.oy += (d.cy-cy)*0.04*f; } } });
            function draw(){
              const ctx = canvas.getContext('2d');
              if(!ctx) return;
              ctx.clearRect(0,0,canvas.width,canvas.height);
              const rect = canvas.getBoundingClientRect();
              const dpr = window.devicePixelRatio || 1;
              ctx.save(); ctx.scale(dpr,dpr);
              for(const d of dotsRef.current){
                // simple spring back
                d.ox *= 0.92; d.oy *= 0.92;
                const dx = d.cx - pointer.x; const dy = d.cy - pointer.y;
                const dist = Math.hypot(dx,dy);
                let alpha = 0.1;
                let dotSize = 3;
                if(dist<150){
                  alpha = 0.2*(1 - dist/150) + 0.15;
                  dotSize = 3 + 3*(1 - dist/150);
                }
                ctx.beginPath();
                ctx.fillStyle = `rgba(82,39,255,${alpha})`;
                ctx.arc(d.cx + d.ox, d.cy + d.oy, dotSize, 0, Math.PI*2);
                ctx.fill();
              }
              ctx.restore();
              raf = requestAnimationFrame(draw);
            }
            raf = requestAnimationFrame(draw);
            return ()=>{ window.removeEventListener('resize', resize); cancelAnimationFrame(raf); };
          }, []);
          return (<div style={{position:'absolute',inset:0,zIndex:0}} ref={wrapperRef}><canvas ref={canvasRef} style={{width:'100%',height:'100%'}} /></div>);
        }

        async function generate(){
          // add quick visual pop + sheen before starting the request
          const btn = document.getElementById('generate');
          if(btn){
            btn.classList.remove('pop');
            // force reflow so animation retriggers
            void btn.offsetWidth;
            btn.classList.add('pop');
            btn.classList.add('sheen');
            // animate background continuously while active
            btn.classList.add('animate-bg');
            setTimeout(()=>{ btn.classList.remove('sheen'); }, 420);
          }
          setLoading(true); setReveal(false);
          try{
            const tone = styles[styleIndex] || 'Motivational';
            const url = GAS_URL + (GAS_URL.indexOf('?')===-1?'?':'&') + '_ts=' + Date.now() + '&n=' + encodeURIComponent(n) + '&tone=' + encodeURIComponent(tone);
            console.log('Fetching URL:', url);
            const res = await fetch(url, { cache: 'no-store' });
            if(!res.ok) throw new Error('Network ' + res.status);
            const data = await res.json();
            console.log('Response:', data);
            setQuote(data && data.quote ? data.quote : 'No quote returned.');
            // reveal with decrypted animation
            setTimeout(()=> setReveal(true), 80);
          }catch(err){ setQuote('Error: ' + (err.message||err)); setReveal(true); }
          finally{ setLoading(false); }
        }

        return (
          <div style={{position:'relative'}}>
            <DotGridOverlay />
            <div style={{position:'relative', zIndex:1}}>
              <h1 id="title" style={{fontSize:18, marginBottom:12, fontWeight:800, letterSpacing:0.4}}>
                Generate a&nbsp;
                <span style={{display:'inline-flex',alignItems:'center',gap:10,padding:'6px 10px'}}>
                  <span style={{fontSize:16, color:'#9fb0d3'}}>[</span>
                  <span style={{display:'inline-flex',alignItems:'center',gap:10}}>
                    <div style={{display:'flex',flexDirection:'column',alignItems:'center',gap:6}}>
                      <button className="arrow" style={{padding:'6px 8px'}} onClick={()=>setN(v=>Math.max(3,Math.min(20,v+1)))} aria-label="Increase">▲</button>
                      <Counter value={n} places={[10,1]} fontSize={30} padding={4} gap={20} textColor='white' fontWeight={900} />
                      <button className="arrow" style={{padding:'6px 8px'}} onClick={()=>setN(v=>Math.max(3,Math.min(20,v-1)))} aria-label="Decrease">▼</button>
                    </div>
                  </span>
                  <span style={{fontSize:16, color:'#9fb0d3'}}>]</span>
                </span>
                &nbsp;words
                &nbsp;
                <span style={{display:'inline-flex',alignItems:'center',gap:12,padding:'6px 10px'}}>
                  <span style={{fontSize:16, color:'#9fb0d3'}}>[</span>
                  <div style={{display:'flex',flexDirection:'column',alignItems:'center',gap:6}}>
                    <button className="arrow" style={{padding:'6px 8px'}} onClick={()=>setStyleIndex(i=> (i+1) % styles.length)} aria-label="Increase style">▲</button>
                    <WordScroller items={styles} index={styleIndex} fontSize={30} lineHeight={40} minWidth={200} />
                    <button className="arrow" style={{padding:'6px 8px'}} onClick={()=>setStyleIndex(i=> (i-1+styles.length) % styles.length)} aria-label="Decrease style">▼</button>
                  </div>
                  <span style={{fontSize:16, color:'#9fb0d3'}}>]</span>
                </span>
                &nbsp;sentence.
              </h1>

            <DecryptedText text={quote} reveal={reveal} />

            <div style={{marginTop:8}}>
              <button id="generate" type="button" className={`gooey ${loading? 'loading' : ''}`} onClick={generate}>
                <span className="btn-text">{loading? 'Generating...' : 'Generate'}</span>
              </button>
            </div>
              <footer style={{marginTop:14, fontSize:12, color:'#9fb0d3'}}>
                Created by <a href="https://pooyanasiri.github.io" style={{color: '#9fb0d3', textDecoration: 'none'}}>Pooya Nasiri</a> | Powered by Google Apps Script & OpenAI API
              </footer>
            </div>
            <div id="copy-toast" role="status" aria-live="polite">Copied to clipboard!</div>
          </div>
        );
      }

      // Enhance DecryptedText with click/keyboard copy handling by enhancing its output element after mount.
      (function enhanceDecryptedCopy(){
        // Wait for React to render; use event delegation on the root to avoid touching internal component scope
        document.addEventListener('click', async function(e){
          const tgt = e.target.closest('.quote');
          if(!tgt) return;
          e.preventDefault();
          const text = tgt.textContent || tgt.innerText || '';
          const ok = await copyToClipboard(text);
          if(ok) showCopyToast();
        });
        // keyboard support: Enter/Space on focused .quote
        document.addEventListener('keydown', async function(e){
          const active = document.activeElement;
          if(!active || !active.classList.contains('quote')) return;
          if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); const text = active.textContent || ''; const ok = await copyToClipboard(text); if(ok) showCopyToast(); }
        });
      })();

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>

    <!-- goo SVG filter (required for gooey blur) -->
    <svg width="0" height="0" style="position:absolute">
      <filter id="goo" x="-50%" y="-50%" width="200%" height="200%">
        <feComponentTransfer>
          <feFuncA type="discrete" tableValues="0 1"></feFuncA>
        </feComponentTransfer>
        <feGaussianBlur stdDeviation="5"></feGaussianBlur>
        <feComponentTransfer>
          <feFuncA type="table" tableValues="-5 11"></feFuncA>
        </feComponentTransfer>
      </filter>
    </svg>

    <style>
@media (prefers-reduced-motion: reduce){
  *{animation:none!important;transition:none!important}
}
</style>
</body>
</html>
