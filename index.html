<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AIQuotes</title>
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center;background:linear-gradient(135deg,#07132b 0%, #081426 40%, #10243a 100%);color:#e6eef8;margin:0}
      .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:28px;border-radius:14px;box-shadow:0 10px 40px rgba(2,6,23,.7);width:min(760px,94%);text-align:center;border:1px solid rgba(255,255,255,0.03)}
      h1{margin:0 0 12px 0;font-size:20px;letter-spacing:.6px}
      .controls{display:flex;flex-direction:column;gap:10px;align-items:center;margin-bottom:14px}
      .control-row{display:flex;gap:12px;align-items:center}
      .control-row.small{font-size:13px;color:#9fb0d3}
      .label{font-weight:600}
      .vertical-number{display:flex;flex-direction:column;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:6px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);width:88px;transition:transform .28s cubic-bezier(.2,.9,.2,1)}
      .vertical-number:hover{transform:translateY(-4px)}
      .vertical-number .arrow{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border:none;color:#cfe6ff;padding:6px 8px;font-size:12px;cursor:pointer;line-height:1;border-radius:8px;margin:6px;transition:transform .18s ease, box-shadow .18s ease}
      .vertical-number .arrow:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(124,58,237,.08)}
      /* general arrow style used in the inline header control */
      .arrow{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border:none;color:#cfe6ff;padding:4px 10px;font-size:12px;cursor:pointer;line-height:1;border-radius:8px;min-width:44px;height:30px;display:inline-flex;align-items:center;justify-content:center;transition:transform .18s ease, box-shadow .18s ease}
      .arrow:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(124,58,237,.08)}
      .vertical-number input[type=number]{width:64px;background:transparent;border:none;color:#e6eef8;text-align:center;font-size:20px;-moz-appearance:textfield;transition:transform .28s cubic-bezier(.2,.9,.2,1), color .18s}
      .vertical-number input[type=number].num-animate{animation:numPop .36s ease}
      @keyframes numPop{0%{transform:translateY(-6px) scale(.95);opacity:.6}50%{transform:translateY(3px) scale(1.06);opacity:1}100%{transform:translateY(0) scale(1)} }
      /* Counter styles (inspired by reactbits Counter) */
      .counter-container { position: relative; display: inline-block; }
      .counter-counter { display: flex; overflow: hidden; line-height: 1; }
      .counter-digit { position: relative; width: 1ch; font-variant-numeric: tabular-nums; }
      .counter-number { position: absolute; top: 0; right: 0; bottom: 0; left: 0; display:flex; align-items:center; justify-content:center; }
      .gradient-container { pointer-events: none; position: absolute; top: 0; bottom: 0; left: 0; right: 0; }
      .bottom-gradient { position: absolute; bottom: 0; width: 100%; }
      /* dot-grid background (subtle overlay like reactbits dot-grid) */
      body::before{content:'';position:fixed;inset:0;pointer-events:none;opacity:0.06;background-image:radial-gradient(rgba(255,255,255,0.12) 1px, rgba(255,255,255,0) 1px);background-size:18px 18px;mix-blend-mode:overlay}
      input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
      button#generate{position:relative;overflow:hidden;background:linear-gradient(90deg,#7c3aed,#2dd4bf);border:none;color:#041025;padding:12px 22px;border-radius:14px;font-weight:800;cursor:pointer;box-shadow:0 10px 30px rgba(124,58,237,.14);transition:transform .12s ease, box-shadow .12s ease}
      button#generate:active{transform:translateY(1px) scale(.996)}
      button#generate .btn-text{display:inline-block;transition:transform .18s cubic-bezier(.2,.9,.2,1)}
      button#generate .spinner{position:absolute;right:12px;top:50%;transform:translateY(-50%) scale(.6);width:14px;height:14px;border-radius:50%;box-shadow:inset 0 0 0 3px rgba(255,255,255,0.15);opacity:0;transition:opacity .18s, transform .18s}
      button#generate.loading{box-shadow:0 14px 40px rgba(45,212,191,.08);transform:translateY(-2px)}
      button#generate.loading .spinner{opacity:1;transform:translateY(-50%) scale(1);animation:spin 900ms linear infinite}
      @keyframes spin{0%{transform:translateY(-50%) rotate(0)}100%{transform:translateY(-50%) rotate(360deg)}}
      #quote{font-size:36px;margin:36px 0 44px;line-height:1.18;color:#e8f6ff;min-height:120px;transition:opacity .22s ease, transform .22s cubic-bezier(.2,.9,.2,1)}
      #quote.out{opacity:0;transform:translateY(8px) scale(.98)}
      #quote.in{opacity:1;transform:translateY(0) scale(1)}

      /* small decorative shimmer when generating */
      .shimmer{position:relative;overflow:hidden}
      .shimmer:after{content:'';position:absolute;left:-40%;top:0;width:40%;height:100%;transform:skewX(-18deg);background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.07), rgba(255,255,255,0));opacity:0;transition:opacity .12s}
      button#generate.loading ~ .quote.shimmer:after{opacity:1;animation:shimmer 900ms linear}
      @keyframes shimmer{0%{left:-40%}100%{left:140%}}
      footer{font-size:12px;color:#9fb0d3;margin-top:14px}
      @media (max-width:520px){
        .control-row{flex-direction:column}
        #quote{font-size:20px;margin:18px 0 20px;min-height:64px}
        .arrow{min-width:36px;font-size:11px;height:28px;padding:4px 8px}
      }
    </style>
  </head>
  <body>
    <main class="card">
      <div id="root"></div>
    </main>

    <!-- React + Babel (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Small React app implementing a fancy Counter and DecryptedText reveal -->
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // Simple DecryptedText: reveals text character-by-character with 'decrypt' effect
      function DecryptedText({ text, reveal }){
        const [out, setOut] = useState('');
        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        useEffect(()=>{
          if(!reveal){ setOut(text); return; }
          let cancelled = false;
          const target = text || '';
          const len = target.length;
          let frame = 0;
          const steps = 18 + Math.floor(len/2);
          const interval = 28;
          const tm = setInterval(()=>{
            frame++;
            let s = '';
            for(let i=0;i<len;i++){
              if(i < Math.floor((frame/steps)*len)) s += target[i];
              else s += alphabet[Math.floor(Math.random()*alphabet.length)];
            }
            if(!cancelled) setOut(s);
            if(frame >= steps){
              if(!cancelled) setOut(target);
              clearInterval(tm);
            }
          }, interval);
          return ()=>{ cancelled = true; clearInterval(tm); };
        }, [text, reveal]);
        return (<div className="quote shimmer in" aria-live="polite">{out}</div>);
      }

      // Rich animated Counter (single-file, no external motion lib)
      function Digit({ place, value, height, digitStyle }){
        const valueRoundedToPlace = Math.floor(value / place);
        const animatedRef = useRef(valueRoundedToPlace);
        const [, setTick] = useState(0);
        const targetRef = useRef(valueRoundedToPlace);

        useEffect(()=>{ targetRef.current = valueRoundedToPlace; }, [valueRoundedToPlace]);

        useEffect(()=>{
          let raf;
          let mounted = true;
          function step(){
            if(!mounted) return;
            const cur = animatedRef.current;
            const target = targetRef.current;
            const diff = target - cur;
            const next = Math.abs(diff) < 0.0001 ? target : cur + diff * 0.22;
            animatedRef.current = next;
            // trigger render
            setTick(t => t + 1);
            raf = requestAnimationFrame(step);
          }
          raf = requestAnimationFrame(step);
          return ()=>{ mounted = false; cancelAnimationFrame(raf); };
        }, []);

        return (
          <div className="counter-digit" style={{ height: height + 'px', ...digitStyle }}>
            {Array.from({length:10}, (_, i)=>{
              const animated = animatedRef.current;
              // compute continuous offset and wrap to nearest -5..4
              let pos = (i - animated) % 10;
              if(pos < -5) pos += 10;
              if(pos > 4) pos -= 10;
              const memo = pos * height;
              const style = { transform: `translateY(${memo}px)` };
              return (<div key={i} className="counter-number" style={style}>{i}</div>);
            })}
          </div>
        );
      }

      function Counter({ value, fontSize = 80, padding = 5, places = [100,10,1], gap = 10, textColor='white', fontWeight=900 }){
        const height = fontSize + padding;
        const counterStyle = { fontSize: fontSize + 'px', gap: gap + 'px', color: textColor, fontWeight };
        return (
          <div className="control-row" style={{alignItems:'center', justifyContent:'center'}}>
            <div className="counter-container">
              <div className="counter-counter" style={{ ...counterStyle }}>
                {places.map(p => (<Digit key={p} place={p} value={value} height={height} digitStyle={{}} />))}
              </div>
            </div>
          </div>
        );
      }

      function App(){
          const [n, setN] = useState(5);
            const [quote, setQuote] = useState('');
            const [loading, setLoading] = useState(false);
            const [reveal, setReveal] = useState(false);
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbx-oQu_NIQAmJGNu8saRPOfbzrFl5wjyS8P9MuSkiYUpzLwds7XTYGbQrvPApDyYNtaTw/exec';

        // Simple DotGrid background component (lightweight, no GSAP)
        function DotGridOverlay(){
          const canvasRef = useRef(null);
          const wrapperRef = useRef(null);
          const dotsRef = useRef([]);
          useEffect(()=>{
            const canvas = canvasRef.current;
            const wrap = wrapperRef.current;
            if(!canvas || !wrap) return;
            const resize = ()=>{
              const rect = wrap.getBoundingClientRect();
              const dpr = window.devicePixelRatio || 1;
              canvas.width = rect.width * dpr;
              canvas.height = rect.height * dpr;
              canvas.style.width = rect.width + 'px';
              canvas.style.height = rect.height + 'px';
              const gap = 18;
              const dotSize = 6;
              const cols = Math.floor((rect.width + gap)/(dotSize+gap));
              const rows = Math.floor((rect.height + gap)/(dotSize+gap));
              const cell = dotSize + gap;
              const gridW = cell * cols - gap;
              const gridH = cell * rows - gap;
              const extraX = rect.width - gridW;
              const extraY = rect.height - gridH;
              const startX = extraX/2 + dotSize/2;
              const startY = extraY/2 + dotSize/2;
              const dots = [];
              for(let y=0;y<rows;y++){
                for(let x=0;x<cols;x++){
                  dots.push({cx: startX + x*cell, cy: startY + y*cell, ox:0, oy:0});
                }
              }
              dotsRef.current = dots;
            };
            resize();
            window.addEventListener('resize', resize);
            let raf;
            const pointer = {x:-9999,y:-9999};
            window.addEventListener('mousemove', (e)=>{ const r = canvas.getBoundingClientRect(); pointer.x = e.clientX - r.left; pointer.y = e.clientY - r.top; });
            window.addEventListener('click', (e)=>{ const r = canvas.getBoundingClientRect(); const cx = e.clientX - r.left; const cy = e.clientY - r.top; for(const d of dotsRef.current){ const dist = Math.hypot(d.cx-cx,d.cy-cy); if(dist<120){ const f = 1 - dist/120; d.ox += (d.cx-cx)*0.04*f; d.oy += (d.cy-cy)*0.04*f; } } });
            function draw(){
              const ctx = canvas.getContext('2d');
              if(!ctx) return;
              ctx.clearRect(0,0,canvas.width,canvas.height);
              const rect = canvas.getBoundingClientRect();
              const dpr = window.devicePixelRatio || 1;
              ctx.save(); ctx.scale(dpr,dpr);
              for(const d of dotsRef.current){
                // simple spring back
                d.ox *= 0.92; d.oy *= 0.92;
                const dx = d.cx - pointer.x; const dy = d.cy - pointer.y;
                const dist = Math.hypot(dx,dy);
                let alpha = 0.06;
                if(dist<150) alpha = 0.18*(1 - dist/150) + 0.02;
                ctx.beginPath();
                ctx.fillStyle = `rgba(82,39,255,${alpha})`;
                ctx.arc(d.cx + d.ox, d.cy + d.oy, 3, 0, Math.PI*2);
                ctx.fill();
              }
              ctx.restore();
              raf = requestAnimationFrame(draw);
            }
            raf = requestAnimationFrame(draw);
            return ()=>{ window.removeEventListener('resize', resize); cancelAnimationFrame(raf); };
          }, []);
          return (<div style={{position:'absolute',inset:0,zIndex:0}} ref={wrapperRef}><canvas ref={canvasRef} style={{width:'100%',height:'100%'}} /></div>);
        }

        async function generate(){
          setLoading(true); setReveal(false);
          try{
            const url = GAS_URL + (GAS_URL.indexOf('?')===-1?'?':'&') + '_ts=' + Date.now() + '&n=' + encodeURIComponent(n);
            console.log('Fetching URL:', url);
            const res = await fetch(url, { cache: 'no-store' });
            if(!res.ok) throw new Error('Network ' + res.status);
            const data = await res.json();
            console.log('Response:', data);
            setQuote(data && data.quote ? data.quote : 'No quote returned.');
            // reveal with decrypted animation
            setTimeout(()=> setReveal(true), 80);
          }catch(err){ setQuote('Error: ' + (err.message||err)); setReveal(true); }
          finally{ setLoading(false); }
        }

        return (
          <div style={{position:'relative'}}>
            <DotGridOverlay />
            <div style={{position:'relative', zIndex:1}}>
              <h1 id="title" style={{fontSize:18, marginBottom:12, fontWeight:800, letterSpacing:0.4}}>
                Generate a&nbsp;
                <span style={{display:'inline-flex',alignItems:'center',gap:12,padding:'6px 10px',background:'rgba(255,255,255,0.006)'}}>
                  <span style={{fontSize:16, color:'#9fb0d3'}}>[</span>
                  <span style={{display:'inline-flex',alignItems:'center',gap:8}}>
                    <div style={{display:'flex',flexDirection:'column',alignItems:'center',gap:6}}>
                      <button className="arrow" style={{padding:'6px 8px'}} onClick={()=>setN(v=>Math.max(3,Math.min(20,v+1)))} aria-label="Increase">▲</button>
                      <Counter value={n} places={[100,10,1]} fontSize={40} padding={4} gap={6} textColor='white' fontWeight={900} />
                      <button className="arrow" style={{padding:'6px 8px'}} onClick={()=>setN(v=>Math.max(3,Math.min(20,v-1)))} aria-label="Decrease">▼</button>
                    </div>
                  </span>
                  <span style={{fontSize:16, color:'#9fb0d3'}}>]</span>
                </span>
                &nbsp;words Motivational sentence.
              </h1>

            <DecryptedText text={quote} reveal={reveal} />

            <div style={{marginTop:8}}>
              <button id="generate" className={loading? 'loading' : ''} onClick={generate}>
                <span className="btn-text">{loading? 'Generating...' : 'Generate'}</span>
                <span className="spinner" aria-hidden="true" style={{display: loading? 'inline-block':'none'}}></span>
              </button>
            </div>

              <footer style={{marginTop:14,fontSize:12,color:'#9fb0d3'}}>Powered by a Google Apps Script backend + OpenAI API</footer>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
